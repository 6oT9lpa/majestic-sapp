<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Majestic | Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', path='fonts/fontawesome/css/all.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='fonts/roboto/roboto.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='styles/root.css?v=0.0.5') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='styles/dashboard.css?v=0.0.27') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='styles/modal.css?v=0.0.7') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='styles/tooltip.css?v=0.0.3') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='styles/navbar.css?v=0.0.2') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='styles/messanger.css?v=0.0.12') }}">
</head>
<body>
    <div class="dashboard-container">
        <!-- Верхняя панель с вкладками -->
        <div class="dashboard-header">
            <div class="dashboard-tabs">
                <button class="tab-btn active" data-tab="profile">Профиль</button>
                <button class="tab-btn" data-tab="appeals">Обращения</button>
                {% if user["role"] and user["role"]["level"] >= 2 %}
                    <button class="tab-btn" data-tab="stats">Статистика</button>
                    <button class="tab-btn" data-tab="admin" onclick="window.location.href='/dashboard/admin'">Админ</button>
                {% endif %}
                <div class="tab-indicator"></div>
            </div>
            <div class="group-header dashboard-tabs">
                <div class="tooltip-container">
                    <button class='btn nav-btn' id="appeal-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                    </button>
                    <span class="tooltip-text">Создать обращение</span>
                </div>
                <div class="tooltip-container">
                    <button class="nav-btn" data-tab="settings">
                        <svg fill="currentColor" height="24px" width="24px"  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 458.12 458.12">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <path d="M229.063,106.991c-67.305,0-122.062,54.756-122.062,122.061c0,67.305,54.757,122.062,122.062,122.062 s122.062-54.756,122.062-122.062C351.124,161.747,296.367,106.991,229.063,106.991z M229.063,331.114 c-56.277,0-102.062-45.785-102.062-102.062s45.784-102.061,102.062-102.061s102.062,45.784,102.062,102.061 S285.34,331.114,229.063,331.114z"></path> <path d="M229.063,175.963c-29.273,0-53.089,23.815-53.089,53.089s23.815,53.089,53.089,53.089s53.089-23.816,53.089-53.089 S258.336,175.963,229.063,175.963z M229.063,252.141c-12.731,0-23.089-10.358-23.089-23.089s10.357-23.089,23.089-23.089 s23.089,10.357,23.089,23.089S241.794,252.141,229.063,252.141z"></path> <path d="M454.321,187.337c-1.312-7.116-7.516-12.281-14.751-12.281h-25.108c-3.931-13.533-9.327-26.554-16.131-38.915l17.77-17.77 c5.12-5.12,5.852-13.165,1.74-19.125c-7.904-11.457-16.924-22.278-26.808-32.162c-9.903-9.904-20.731-18.925-32.185-26.814 c-5.961-4.104-13.999-3.37-19.115,1.747l-17.769,17.769c-12.363-6.804-25.39-12.207-38.909-16.136V18.531 c0-7.24-5.171-13.447-12.292-14.753c-27.411-5.03-56.096-5.023-83.417,0.012c-7.116,1.312-12.281,7.516-12.281,14.751V43.65 c-13.522,3.93-26.548,9.333-38.909,16.136l-17.77-17.769c-5.116-5.116-13.155-5.851-19.115-1.747 c-11.45,7.886-22.278,16.908-32.185,26.814c-9.886,9.885-18.904,20.706-26.808,32.163c-4.11,5.959-3.378,14.004,1.741,19.124 l17.773,17.774c-6.802,12.36-12.197,25.379-16.128,38.911H18.55c-7.236,0-13.44,5.166-14.752,12.282 C1.278,201.015,0,215.052,0,229.056c0,13.976,1.274,28.005,3.786,41.697c1.307,7.122,7.514,12.293,14.754,12.293h25.126 c3.931,13.532,9.326,26.551,16.128,38.911l-17.767,17.767c-5.116,5.116-5.852,13.156-1.747,19.115 c7.886,11.449,16.906,22.278,26.813,32.185c9.885,9.885,20.705,18.904,32.162,26.808c5.958,4.111,14.003,3.379,19.124-1.74 l17.776-17.776c12.362,6.804,25.389,12.207,38.909,16.137v25.109c0,7.236,5.165,13.44,12.281,14.751 c13.675,2.521,27.711,3.798,41.719,3.798c13.979,0,28.007-1.274,41.698-3.787c7.121-1.307,12.292-7.514,12.292-14.753v-25.12 c13.522-3.93,26.547-9.332,38.909-16.136l17.775,17.775c5.119,5.12,13.164,5.852,19.124,1.741 c11.457-7.903,22.277-16.923,32.162-26.807c9.903-9.903,18.925-20.731,26.814-32.185c4.104-5.959,3.37-13.999-1.747-19.115 l-17.763-17.763c6.804-12.361,12.2-25.382,16.131-38.915h25.118c7.24,0,13.446-5.171,14.754-12.292 c2.512-13.687,3.786-27.717,3.786-41.698C458.12,215.046,456.842,201.009,454.321,187.337z M426.688,253.046h-23.854 c-7.023,0-13.107,4.874-14.639,11.729c-4.093,18.314-11.279,35.651-21.358,51.529c-3.765,5.93-2.909,13.679,2.058,18.646 l16.875,16.876c-4.942,6.292-10.282,12.313-15.955,17.986c-5.665,5.665-11.683,11.002-17.977,15.95l-16.884-16.883 c-4.967-4.968-12.716-5.822-18.645-2.058c-14.822,9.408-30.932,16.308-47.887,20.508c-1.208,0.3-2.428,0.573-3.646,0.846 c-6.851,1.535-11.72,7.617-11.72,14.637v23.867c-15.911,1.906-32.116,1.904-47.99-0.003v-23.865 c0-7.023-4.873-13.106-11.727-14.639c-1.219-0.272-2.437-0.545-3.649-0.846c-16.947-4.199-33.056-11.098-47.877-20.506 c-5.927-3.763-13.677-2.909-18.645,2.057l-16.885,16.884c-6.294-4.948-12.312-10.286-17.977-15.951 c-5.675-5.675-11.014-11.695-15.955-17.985l16.88-16.88c4.967-4.966,5.822-12.714,2.058-18.645 c-10.077-15.878-17.263-33.214-21.355-51.527c-1.532-6.854-7.615-11.728-14.639-11.728H31.433C30.48,245.096,30,237.067,30,229.056 c0-8.023,0.481-16.056,1.436-24h23.859c7.023,0,13.106-4.874,14.639-11.728c4.093-18.313,11.278-35.649,21.355-51.527 c3.765-5.93,2.909-13.678-2.058-18.645L72.35,106.274c4.947-6.294,10.285-12.311,15.95-17.976 c5.675-5.675,11.695-11.014,17.985-15.956l16.883,16.882c4.967,4.966,12.714,5.821,18.645,2.057 c14.821-9.408,30.93-16.307,47.882-20.507c1.208-0.3,2.426-0.572,3.645-0.845c6.854-1.533,11.727-7.616,11.727-14.639V31.427 c15.874-1.906,32.079-1.909,47.99-0.003v23.867c0,7.02,4.869,13.102,11.72,14.637c1.219,0.273,2.438,0.546,3.654,0.848 c16.947,4.199,33.056,11.098,47.879,20.506c5.93,3.764,13.679,2.91,18.645-2.058l16.882-16.881 c6.292,4.942,12.312,10.281,17.985,15.955c5.665,5.665,11.003,11.683,15.951,17.977l-16.878,16.878 c-4.967,4.967-5.822,12.715-2.058,18.646c10.079,15.878,17.266,33.215,21.358,51.529c1.531,6.854,7.615,11.729,14.639,11.729 h23.852c0.954,7.942,1.436,15.975,1.436,24C428.12,237.069,427.64,245.097,426.688,253.046z"></path> </g> </g>
                        </svg>
                    </button>
                    <span class="tooltip-text">Настройки </span>
                </div>
                <div class="tooltip-container">
                    <button class='nav-btn btn theme-toggle' aria-label="Переключить тему">
                        <!-- Иконка солнца -->
                        <svg class="theme-icon sun-icon" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24" stroke-width="2">
                        <circle cx="12" cy="12" r="5"></circle>
                        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
                        </svg>
                        <!-- Иконка луны -->
                        <svg class="theme-icon moon-icon" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                    </button>
                    <span class="tooltip-text">Сменить тему</span>
                </div> 
                <div class="tooltip-container">
                    <button id="logout-btn" class="nav-btn">
                        <svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g clip-path="url(#clip0_429_11067)"> <path d="M15 4.00098H5V18.001C5 19.1055 5.89543 20.001 7 20.001H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M16 15.001L19 12.001M19 12.001L16 9.00098M19 12.001H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g> <defs> <clipPath id="clip0_429_11067"> <rect width="24" height="24" fill="currentColor" transform="translate(0 0.000976562)"></rect> </clipPath> </defs> </g></svg>
                    </button>
                    <span class="tooltip-text">Выйти с аккаунта</span>
                </div>
            </div>  
        </div>

        <!-- Контент dashboard -->
        <div class="dashboard-content">
            <!-- Вкладка профиля -->
            <div class="tab-content active" id="profile-tab">
                <div class="profile-container">
                    <div class="user-info">
                        <div class="user-avatar">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div class="user-details">
                            <h2 id="user-nickname"></h2>
                            <div class="detail-row">
                                <span class="detail-label">Email:</span>
                                <div class='email-group'>
                                    <span id="user-email" class="detail-value"></span>
                                    <span id="email-verified" class="verified-badge"></span>
                                </div>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Роль:</span>
                                <span id="user-role" class="detail-value"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Регистрация:</span>
                                <span id="user-reg-date" class="detail-value"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">ID:</span>
                                <span id="user-id" class="detail-value"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="activity-section">
                        <h3>Последние действия</h3>
                        <div class="activity-list" id="recent-activities">
                            <!-- Будет заполнено через JavaScript -->
                            <div class="activity-placeholder">
                                <i class="fas fa-spinner fa-spin"></i> Загрузка...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Вкладка обращений -->
            <div class="tab-content" id="appeals-tab">
                <div class="appeals-container">
                    <div class="appeals-header">
                        <h2>Мои обращения</h2>
                        <button id="appeal-btn" class="primary-btn">
                            <i class="fas fa-plus"></i> Новое обращение
                        </button>
                    </div>
                    <div class="appeals-list">
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Тип</th>
                                        <th>Дата</th>
                                        <th>Статус</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody id="appeals-table-body">
                                    <tr>
                                        <td colspan="4" class="loading-row">
                                            <i class="fas fa-spinner fa-spin"></i> Загрузка обращений...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            {% include "appeal/appeal_chat.html" %}

            <!-- Вкладка статистики -->
            <div class="tab-content" id="stats-tab">
                <div class="stats-container">
                    <div class="stats-header">
                        <h2>Статистика работы</h2>
                        <div class="stats-period">
                            <select id="stats-period">
                                <option value="week">Неделя</option>
                                <option value="month" selected>Месяц</option>
                                <option value="3months">3 месяца</option>
                                <option value="year">Год</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stats-summary">
                            <div class="stats-card">
                                <div class="stats-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="stats-content">
                                    <div class="stats-value" id="resolved-count">0</div>
                                    <div class="stats-label">Решено</div>
                                </div>
                            </div>
                            
                            <div class="stats-card">
                                <div class="stats-icon">
                                    <i class="fas fa-times-circle"></i>
                                </div>
                                <div class="stats-content">
                                    <div class="stats-value" id="rejected-count">0</div>
                                    <div class="stats-label">Отклонено</div>
                                </div>
                            </div>
                            
                            <div class="stats-card">
                                <div class="stats-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="stats-content">
                                    <div class="stats-value" id="pending-count">0</div>
                                    <div class="stats-label">В работе</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stats-details">
                            <div class="stats-section">
                                <h3>Детализация</h3>
                                <div class="stats-detail-grid">
                                    <div class="detail-card">
                                        <div class="detail-value" id="complaints-resolved">0</div>
                                        <div class="detail-label">Жалоб решено</div>
                                    </div>
                                    <div class="detail-card">
                                        <div class="detail-value" id="appeals-resolved">0</div>
                                        <div class="detail-label">Обращений решено</div>
                                    </div>
                                    <div class="detail-card">
                                        <div class="detail-value" id="delays-count">0</div>
                                        <div class="detail-label">Просрочек</div>
                                    </div>
                                    <div class="detail-card">
                                        <div class="detail-value" id="bans-issued">0</div>
                                        <div class="detail-label">Выдано банов</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="stats-section">
                                <h3>Финансы</h3>
                                <div class="stats-finance">
                                    <div class="finance-card">
                                        <div class="finance-value" id="total-earned">0 ₽</div>
                                        <div class="finance-label">Всего заработано</div>
                                    </div>
                                    <div class="finance-card">
                                        <div class="finance-value" id="total-fine">0 ₽</div>
                                        <div class="finance-label">Штрафы</div>
                                    </div>
                                    <div class="finance-card">
                                        <div class="finance-value" id="total-payment">0 ₽</div>
                                        <div class="finance-label">К выплате</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно настроек -->
    <div class="modal hidden" id="settingsModal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>

            <div class="modal-tabs">
                <button class="tab-btn active" data-tab="profile-settings">
                    <i class="fas fa-user-edit"></i> Профиль
                </button>
                <button class="tab-btn" data-tab="security-settings">
                    <i class="fas fa-key"></i> Безопасность
                </button>
                <button class="tab-btn" data-tab="danger-zone">
                    <i class="fas fa-exclamation-triangle"></i> Опасная зона
                </button>
                <div class="tab-indicator"></div>
            </div>
            
            <!-- Вкладка профиля -->
            <div class="tab-content active" id="profile-settings-tab">
                <form id="change-username-form" class="auth-form">
                    <div class="form-group">
                        <label for="new-username">Новый никнейм</label>
                        <input type="text" id="new-username" placeholder="Придумайте новый никнейм" minlength="3" maxlength="20" required>
                        <div class="form-hint">Можно изменить 1 раз в месяц. Изменение ника может проходить в течение дня</div>
                        <div class="error-message" id="username-error"></div>
                    </div>
                    <button type="submit" class="submit-btn">
                        <span class="btn-text">Изменить никнейм</span>
                    </button>
                </form>
            </div>
            
            <!-- Вкладка безопасности -->
            <div class="tab-content" id="security-settings-tab">
                <form id="change-password-form" class="auth-form">
                    <div class="form-group">
                        <label for="current-password">Текущий пароль</label>
                        <input type="password" id="current-password" placeholder="Введите текущий пароль" required>
                        <div class="password-toggle">
                            <i class="fas fa-eye"></i>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="new-password">Новый пароль</label>
                        <input type="password" id="new-password" placeholder="Придумайте пароль" required>
                        <div class="password-strength">
                            <div class="strength-meter">
                                <div class="strength-bar"></div>
                            </div>
                            <span class="strength-text">Сложность: слабый</span>
                        </div>
                        <div class="password-toggle">
                            <i class="fas fa-eye"></i>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="confirm-password">Подтвердите пароль</label>
                        <input type="password" id="confirm-password" placeholder="Повторите пароль" required>
                        <div class="error-message" id="password-error"></div>
                    </div>
                    <button type="submit" class="submit-btn">
                        <span class="btn-text">Обновить пароль</span>
                    </button>
                </form>
            </div>
            
            <!-- Вкладка опасной зоны -->
            <div class="tab-content" id="danger-zone-tab">
                <form id="delete-account-form" class="auth-form">
                    <div class="danger-warning">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>Эти действия нельзя отменить. Ваш аккаунт будет удален после одобрении модерации.</p>
                    </div>
                    <button type="submit" class="submit-btn danger-btn">
                        <span class="btn-text">Подать заявку на удаление</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    {% include "appeal/appeal_modal.html" %}

    <script>
        const currentUser = {{ user | tojson | safe }};
    </script>

    <script src="{{ url_for('static', path='scripts/root.js?v=0.0.10') }}"></script>
    <script src="{{ url_for('static', path='scripts/messanger.js?v=0.0.59') }}"></script>
    <script src="{{ url_for('static', path='scripts/dashboard.js?v=0.0.47') }}"></script>
    <script src="{{ url_for('static', path='scripts/appeals.js?v=0.0.8') }}"></script>
</body>
</html>