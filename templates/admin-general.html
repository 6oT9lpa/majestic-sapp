<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Majestic | Admin General</title>
    <link rel="stylesheet" href="{{ url_for('static', path='fonts/fontawesome/css/all.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='fonts/roboto/roboto.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='styles/root.css?v=0.0.7') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='styles/dashboard.css?v=0.0.14') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='styles/navbar.css?v=0.0.5') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='styles/modal.css?v=0.0.4') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='styles/tooltip.css?v=0.0.5') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='styles/admin-general.css?v=0.0.7') }}">
    
</head>
<body>
    <div class="dashboard-container">
        <div class="dashboard-header">
            <div class="dashboard-tabs">
                <button class="tab-btn" data-tab="logs">Лог</button>
                <button class="tab-btn" data-tab="users">Пользователи</button>
                <button class="tab-btn" data-tab="user-requests">Заявки</button>
                <div class="tab-indicator"></div>
            </div>
            <div class="group-header dashboard-tabs">
                <div class="tooltip-container">
                    <button class='nav-btn btn theme-toggle' aria-label="Переключить тему">
                        <!-- Иконка солнца -->
                        <svg class="theme-icon sun-icon" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24" stroke-width="2">
                        <circle cx="12" cy="12" r="5"></circle>
                        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
                        </svg>
                        <!-- Иконка луны -->
                        <svg class="theme-icon moon-icon" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                    </button>
                    <span class="tooltip-text">Сменить тему</span>
                </div> 
                <div class="tooltip-container">
                    <button class="nav-btn" onclick="window.location.href='/dashboard/admin'">
                        <svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g clip-path="url(#clip0_429_11067)"> <path d="M15 4.00098H5V18.001C5 19.1055 5.89543 20.001 7 20.001H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M16 15.001L19 12.001M19 12.001L16 9.00098M19 12.001H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g> <defs> <clipPath id="clip0_429_11067"> <rect width="24" height="24" fill="currentColor" transform="translate(0 0.000976562)"></rect> </clipPath> </defs> </g></svg>
                    </button>
                    <span class="tooltip-text">Вернуться назад</span>
                </div>
            </div>  
        </div>

        <div class="dashboard-content">
            <!-- Вкладка логи действий -->
            <div class="tab-content active" id="logs-tab">
                <div class="logs-container">
                    <div class="logs-header">
                        <h2>Логи действий пользователей</h2>
                        <div class="header-actions">
                            <div class="search-box">
                                <input type="text" placeholder="Поиск по типу или пользователю..." id="user-search">
                                <button class="search-btn">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                            <button class="filter-btn" id="filter-toggle">
                                <svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M19 3H5C3.89543 3 3 3.89543 3 5V6.17157C3 6.70201 3.21071 7.21071 3.58579 7.58579L9.41421 13.4142C9.78929 13.7893 10 14.298 10 14.8284V20V20.2857C10 20.9183 10.7649 21.2351 11.2122 20.7878L12 20L13.4142 18.5858C13.7893 18.2107 14 17.702 14 17.1716V14.8284C14 14.298 14.2107 13.7893 14.5858 13.4142L20.4142 7.58579C20.7893 7.21071 21 6.70201 21 6.17157V5C21 3.89543 20.1046 3 19 3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                                Фильтры
                            </button>
                            <div class="filters-panel" id="filters-panel">
                                <div class="filter-group">
                                    <label class="filter-label">Статус</label>
                                    <select class="filter-select" id="status-filter">
                                        <option value="all">Все</option>
                                        <option value="user_login">Вход пользователя</option>
                                        <option value="user_register">Регистрация</option>
                                        <option value="appeal_created">Создание обращения</option>
                                        <option value="appeal_status_changed">Изменение статуса</option>
                                        <option value="role_changed">Изменение роли</option>
                                        <option value="account_deleted">Удаление аккаунта</option>
                                    </select>
                                </div>
                                <div class="filter-actions">
                                    <button class="secondary-btn" id="reset-filters">Сбросить</button>
                                    <button class="primary-btn" id="apply-filters">Применить</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="logs-list">
                        <div class="loading-row">
                            <i class="fas fa-spinner fa-spin"></i> Загрузка логов...
                        </div>
                    </div>
                    <div class="pagination" id="logs-pagination"></div>
                </div>
            </div>

            <!-- Вкладка упраления пользователями -->
            <div class="tab-content" id="users-tab">
                <div class="users-container">
                    <div class="users-header">
                        <h2>Управление пользователями</h2>
                        <div class="header-actions">
                            <div class="search-box">
                                <input type="text" placeholder="Поиск по имени или email..." id="users-search-input">
                                <button class="search-btn" id="users-search-btn">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="users-list">
                        <div class="loading-row">
                            <i class="fas fa-spinner fa-spin"></i> Загрузка пользователей...
                        </div>
                    </div>
                    <div class="pagination" id="users-pagination"></div>
                </div>
            </div>

            <!-- Вкладка заявок от пользователей -->
            <div class="tab-content" id="user-requests-tab">
                <div class="requests-container">
                    <div class="requests-header">
                        <h2>Заявки пользователей</h3>
                        <div class="pagination-info" id="requests-pagination-info"></div>
                    </div>
                    <div class="requests-list" id="user-requests-list">
                        <!-- Заявки будут загружены через JS -->
                    </div>
                    <div class="pagination-container" id="requests-pagination"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно с детальной информацией о пользователе -->
    <div class="modal hidden" id="user-details-modal" style=" display: none;" style=" display: none;">
        <div class="modal-content wide-modal">
            <span class="close-modal">&times;</span>
            <div class="modal-header">
                <h2>Управление пользователем</h2>
            </div>
            
            <div class="modal-tabs">
                <button class="tab-btn active" data-tab="user-info">Основное</button>
                <button class="tab-btn" data-tab="user-appeals">Обращения</button>
                <button class="tab-btn" data-tab="user-requests">Заявки</button>
                <div class="tab-indicator"></div>
            </div>
            
            <div class="tab-content active" id="user-info-tab">
                <div class="user-profile-section">
                    <div class="user-main-info">
                        <h3 id="user-username"></h3>
                        <div class="user-role-badge" id="user-role"></div>
                        <div class="user-email" id="user-email"></div>
                    </div>
                </div>
                
                <div class="user-details-grid">
                    <div class="detail-card">
                        <div class="detail-label">ID пользователя</div>
                        <div class="detail-value" id="user-id"></div>
                    </div>
                    <div class="detail-card">
                        <div class="detail-label">Дата регистрации</div>
                        <div class="detail-value" id="user-created"></div>
                    </div>
                    <div class="detail-card">
                        <div class="detail-label">Последний вход</div>
                        <div class="detail-value" id="user-last-login"></div>
                    </div>
                </div>
                
                <div class="section-header">
                    <h3>Последние изменения</h3>
                </div>
                <div class="history-list compact" id="user-history-list">
                    <!-- История будет загружена через JS -->
                </div>
                <div class="pagination" id="user-history-pagination"></div>
            </div>
            
            <div class="tab-content" id="user-appeals-tab">
                <div class="appeals-list" id="user-created-appeals-section">
                    <div class="section-header">
                        <h3>Созданные обращения</h3>
                        <div class="pagination-info" id="created-appeals-pagination-info"></div>
                    </div>
                    <div class="appeals-list" id="user-created-appeals">
                        <!-- Обращения будут загружены через JS -->
                    </div>
                </div>
                <div class="pagination" id="created-appeals-pagination"></div>
                
                <div class="moderator-section hidden" id="moderator-appeals-section">
                    <div class="section-header">
                        <h3>Рассмотренные обращения</h3>
                        <div class="pagination-info" id="assigned-appeals-pagination-info"></div>
                    </div>
                    <div class="appeals-list" id="user-assigned-appeals">
                        <!-- Назначенные обращения будут загружены через JS -->
                    </div>
                    <div class="pagination" id="assigned-appeals-pagination"></div>
                </div>
            </div>
            
            <div class="tab-content" id="user-requests-tab">
                <div class="section-header">
                    <h3>Заявки пользователя</h3>
                    <div class="pagination-info" id="modal-requests-pagination-info"></div>
                </div>
                <div class="requests-list" id="modal-user-requests-list">
                    <!-- Заявки будут загружены через JS -->
                </div>
                <div class="pagination" id="modal-requests-pagination"></div>
            </div>
            
            <div class="modal-footer">
                <button class="secondary-btn" id='ban-user-btn'>Заблокировать</button>
            </div>
        </div>
    </div>

    <script>
        const currentUser = {{ user | tojson | safe }};
    </script>

    <script src="{{ url_for('static', path='scripts/root.js?v=0.0.1') }}"></script>
    <script src="{{ url_for('static', path='scripts/admin-general.js?v=0.0.25') }}"></script>
</body>
</html>