<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Majestic | Reports</title>
    <link rel="stylesheet" href="{{ url_for('static', path='fonts/fontawesome/css/all.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='fonts/roboto/roboto.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='styles/root.css?v=0.0.5') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='styles/reports.css?v=0.0.18') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='styles/dashboard.css?v=0.0.3') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='styles/tooltip.css?v=0.0.5') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='styles/modal.css?v=0.0.4') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='styles/navbar.css?v=0.0.4') }}">
</head>
<body>
    <div class="dashboard-container">
        <!-- Верхняя панель с вкладками -->
        <div class="dashboard-header">
            <div class="dashboard-tabs">
                <button class="tab-btn active" data-tab="complaints">Жалобы Majestic</button>
                <button class="tab-btn" data-tab="appeals">Обращения</button>
                <button class="tab-btn" data-tab="delays">Просрочки</button>
                <button class="tab-btn" data-tab="user-reports">Отчетность по пользователям</button>
                <div class="tab-indicator"></div>
            </div>
            <div class="group-header dashboard-tabs">
                <div class="tooltip-container">
                    <button class='nav-btn btn theme-toggle' aria-label="Переключить тему">
                        <svg class="theme-icon sun-icon" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24" stroke-width="2">
                            <circle cx="12" cy="12" r="5"></circle>
                            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
                        </svg>
                        <svg class="theme-icon moon-icon" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24" stroke-width="2">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                    </button>
                    <span class="tooltip-text">Сменить тему</span>
                </div> 
                <div class="tooltip-container">
                    <button class="nav-btn" onclick="window.location.href='/dashboard/admin'">
                        <svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M15 4.00098H5V18.001C5 19.1055 5.89543 20.001 7 20.001H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path d="M16 15.001L19 12.001M19 12.001L16 9.00098M19 12.001H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                    </button>
                    <span class="tooltip-text">Вернуться назад</span>
                </div>
            </div>  
        </div>

        <div class="dashboard-content">
            <!-- Вкладка с жалобами -->
            <div class="tab-content active" id="complaints-tab">
                <div class="reports-container">
                    <div class="reports-header">
                        <h2>Жалобы Majestic</h2>
                        <div class="header-actions">
                            <div class="search-box">
                                <input type="text" placeholder="Поиск по имени администратора..." id="complaints-search-input search-input">
                                <button class="search-btn">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                            <button class="filter-btn" id="filter-toggle">
                                <svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M19 3H5C3.89543 3 3 3.89543 3 5V6.17157C3 6.70201 3.21071 7.21071 3.58579 7.58579L9.41421 13.4142C9.78929 13.7893 10 14.298 10 14.8284V20V20.2857C10 20.9183 10.7649 21.2351 11.2122 20.7878L12 20L13.4142 18.5858C13.7893 18.2107 14 17.702 14 17.1716V14.8284C14 14.298 14.2107 13.7893 14.5858 13.4142L20.4142 7.58579C20.7893 7.21071 21 6.70201 21 6.17157V5C21 3.89543 20.1046 3 19 3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                                Фильтры
                            </button>
                            <div class="tooltip-container">
                                <button class="primary-btn" id="upload-reports-btn" style="padding: 4px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="17 8 12 3 7 8"></polyline>
                                        <line x1="12" y1="3" x2="12" y2="15"></line>
                                    </svg>
                                </button>
                                <span class="tooltip-text">Загрузить отчеты из JSON</span>
                            </div>
                            <input type="file" id="reports-file-input" accept=".json" style="display: none;">
                            <div class="filters-panel" id="filters-panel">
                                <div class="filter-group">
                                    <label class="filter-label">Статус</label>
                                    <select class="filter-select" id="status-filter">
                                        <option value="all">Все</option>
                                        <option value="open">Открытые</option>
                                        <option value="closed">Закрытые</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label class="filter-label">Сервер</label>
                                    <select class="filter-select" id="server-filter">
                                        <option value="all">Все серверы</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label class="filter-label">Дата</label>
                                    <input type="date" id="date-filter" class="filter-select">
                                </div>
                                <div class="filter-actions">
                                    <button class="secondary-btn" id="reset-filters">Сбросить</button>
                                    <button class="primary-btn" id="apply-filters">Применить</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="reports-list">
                        <div class="loading-row">
                            <i class="fas fa-spinner fa-spin"></i> Загрузка жалоб...
                        </div>
                    </div>
                    <div class="pagination" id="complaints-pagination"></div>
                </div>
            </div>

            <!-- Вкладка с обращениями -->
            <div class="tab-content" id="appeals-tab">
                <div class="reports-container">
                    <div class="reports-header">
                        <h2>Обращения пользователей</h2>
                        <div class="header-actions">
                            <div class="search-box">
                                <input type="text" placeholder="Поиск по имени администратора..." id="appeals-search-input search-input">
                                <button class="search-btn">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                            <button class="filter-btn" id="appeal-filter-toggle">
                                <svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M19 3H5C3.89543 3 3 3.89543 3 5V6.17157C3 6.70201 3.21071 7.21071 3.58579 7.58579L9.41421 13.4142C9.78929 13.7893 10 14.298 10 14.8284V20V20.2857C10 20.9183 10.7649 21.2351 11.2122 20.7878L12 20L13.4142 18.5858C13.7893 18.2107 14 17.702 14 17.1716V14.8284C14 14.298 14.2107 13.7893 14.5858 13.4142L20.4142 7.58579C20.7893 7.21071 21 6.70201 21 6.17157V5C21 3.89543 20.1046 3 19 3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                                Фильтры
                            </button>
                            <div class="filters-panel" id="appeal-filters-panel">
                                <div class="filter-group">
                                    <label class="filter-label">Статус</label>
                                    <select class="filter-select" id="appeal-status-filter">
                                        <option value="all">Все</option>
                                        <option value="pending" selected>Ожидает</option>
                                        <option value="in_progress" selected>В обработке</option>
                                        <option value="resolved">Завершено</option>
                                        <option value="rejected">Отклонено</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label class="filter-label">Тип</label>
                                    <select class="filter-select" id="appeal-type-filter">
                                        <option value="all">Все</option>
                                        <option value="help">Помощь</option>
                                        <option value="complaint">Жалоба</option>
                                        <option value="amnesty">Амнистия</option>
                                    </select>
                                </div>
                                <div class="filter-actions">
                                    <button class="secondary-btn" id="reset-appeal-filters">Сбросить</button>
                                    <button class="primary-btn" id="apply-appeal-filters">Применить</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="reports-list">
                        <div class="loading-row">
                            <i class="fas fa-spinner fa-spin"></i> Загрузка обращений...
                        </div>
                    </div>
                    <div class="pagination" id="appeals-pagination"></div>
                </div>
            </div>

            <!-- Вкладка с просроками -->
            <div class="tab-content" id="delays-tab">
                <div class="reports-container">
                    <div class="reports-header">
                        <h2>Просроченные жалобы</h2>
                        <div class="header-actions">
                            <div class="search-box">
                                <input type="text" placeholder="Поиск по имени администратора..." id="delays-search-input search-input">
                                <button class="search-btn">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="reports-list">
                        <div class="loading-row">
                            <i class="fas fa-spinner fa-spin"></i> Загрузка просроченных жалоб...
                        </div>
                    </div>
                    <div class="pagination" id="delays-pagination"></div>
                </div>
            </div>

            <!-- Вкладка c пользователями -->
            <div class="tab-content" id="user-reports-tab">
                <div class="reports-container">
                    <div class="reports-header">
                        <h2>Отчетность по пользователям</h2>
                        <div class="header-actions">
                            <div class="search-box">
                                <input type="text" placeholder="Поиск по имени администратора..." id="user-reports-search-input">
                                <button class="search-btn" id="user-reports-search-btn">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                            <button class="primary-btn" id="export-table-btn">
                                <i class="fas fa-table"></i> Экспорт в таблицу
                            </button>
                            <div class="tooltip-container" style="top: 0;">
                                <button class="primary-btn" id='reward-settings-btn' style="padding: 5px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" style="width: 30px"  height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M9 4c-4.42 0-8 3.58-8 8s3.58 8 8 8s8-3.58 8-8s-3.58-8-8-8m0 14c-3.31 0-6-2.69-6-6s2.69-6 6-6s6 2.69 6 6s-2.69 6-6 6m3-7.5h-2v5H8v-5H6V9h6zm8.25-6.75L23 5l-2.75 1.25L19 9l-1.25-2.75L15 5l2.75-1.25L19 1zm0 14L23 19l-2.75 1.25L19 23l-1.25-2.75L15 19l2.75-1.25L19 15z"/></svg>
                                </button>
                                <span class="tooltip-text" style="left: 0;">Изменить подсчет токенов</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="user-reports-tabs">
                        <button class="user-tab-btn active" data-tab="user-stats">Статистика</button>
                        <button class="user-tab-btn" data-tab="user-activity">Активность</button>
                    </div>
                    
                    <!-- Подвкладка со статистикой -->
                    <div class="user-tab-content active" id="user-stats-tab">
                        <div class="reports-list" style="max-height: calc(100vh - 20rem);">
                            <div class="loading-row">
                                <i class="fas fa-spinner fa-spin"></i> Загрузка статистики...
                            </div>
                        </div>
                        <div class="pagination" id="user-stats-pagination"></div>
                    </div>
                    
                    <!-- Подвкладка с активностью -->
                    <div class="user-tab-content" id="user-activity-tab">
                        <div class="activity-chart-container">
                            <canvas id="activityChart"></canvas>
                        </div>
                        <div class="chart-controls">
                            <select id="chart-month-select" class="filter-select">
                                <option value="1">Январь</option>
                                <option value="2">Февраль</option>
                                <option value="3">Март</option>
                                <option value="4">Апрель</option>
                                <option value="5">Май</option>
                                <option value="6">Июнь</option>
                                <option value="7">Июль</option>
                                <option value="8">Август</option>
                                <option value="9">Сентябрь</option>
                                <option value="10">Октябрь</option>
                                <option value="11">Ноябрь</option>
                                <option value="12">Декабрь</option>
                            </select>
                            
                            <select id="chart-year-select" class="filter-select">
                                <!-- Годы будут заполняться динамически через JS -->
                            </select>
                            
                            <button class="primary-btn" id="refresh-chart-btn">
                                <i class="fas fa-sync-alt"></i> Показать
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="rewardSettingsModal" class="modal hidden" style=" display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Настройки вознаграждений</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Токенов за жалобу:</label>
                    <input type="number" id="complaint-reward" min="0">
                </div>
                <div class="form-group">
                    <label>Токенов за обращение:</label>
                    <input type="number" id="appeal-reward" min="0">
                </div>
                <div class="form-group">
                    <label>Штраф за просрочку:</label>
                    <input type="number" id="delay-penalty" min="0">
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn cancel-btn">Отмена</button>
                <button class="primary-btn save-settings-btn">Сохранить</button>
            </div>
        </div>
    </div>

    <div id="editStatsModal" class="modal hidden" style=" display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Редактирование статистики</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Закрытые жалобы:</label>
                    <input type="number" id="edit-complaints-resolved" min="0">
                </div>
                <div class="form-group">
                    <label>Отказанные жалобы:</label>
                    <input type="number" id="edit-complaints-rejected" min="0">
                </div>
                <div class="form-group">
                    <label>Закрытые обращения:</label>
                    <input type="number" id="edit-appeals-resolved" min="0">
                </div>
                <div class="form-group">
                    <label>Отказанные обращения:</label>
                    <input type="number" id="edit-appeals-rejected" min="0">
                </div>
                <div class="form-group">
                    <label>Выданные баны:</label>
                    <input type="number" id="edit-bans-issued" min="0">
                </div>
                <div class="form-group">
                    <label>Просрочки:</label>
                    <input type="number" id="edit-delays" min="0">
                </div>
                <div class="form-group">
                    <label>Штраф:</label>
                    <input type="number" id="edit-fine" min="0">
                </div>
                <div class="form-group">
                    <label>Сервер:</label>
                    <input type="text" id="edit-server" placeholder="Введите сервер">
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn cancel-edit">Отмена</button>
                <button class="primary-btn save-edit">Сохранить</button>
            </div>
        </div>
    </div>

    <div id="confirmUploadModal" class="modal hidden confirm-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Подтверждение загрузки</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body"> 
                <p class="confirmation-text">Вы уверены, что хотите загрузить новые отчеты? Это дополняет существующие данные.</p>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn cancel-confirm-btn">Отмена</button>
                <button class="primary-btn confirm-upload-btn">Да, загрузить</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', path='scripts/root.js?v=0.0.4') }}"></script>
    <script src="{{ url_for('static', path='scripts/reports.js?v=0.0.26') }}"></script>
</body>
</html>